
# TileMapEditor 利用ガイド

## 概要

`TileMapEditor` はUnityエディタ拡張として動作し、タイルマップシーンの新規作成・編集・エクスポートを効率化するツールです。  
主に `summer2025_hunt_tile` マスタ用のマップデータ作成・管理・出力をサポートします。  
タイル配置自体はUnity標準のTilemap機能を利用します（詳細は[こちら](https://hiyotama.hatenablog.com/entry/2021/03/10/221323)等を参照）。

---

## 主な機能

- **新規作成**  
  テンプレートシーン（`MapEditorTemplate.unity`）を複製し、指定したグループID・連番で `Assets/MapEditor/Scene` に新しいシーンを作成し、自動で開きます。  
  → `新規作成` ボタンを押すと、テンプレートから新しいシーンが生成され、即座にそのシーンが開かれます。

- **編集**  
  `Assets/MapEditor/Scene` 内のシーンファイルをファイルピッカーで選択し、開くことができます。  
  → `編集` ボタンを押すとファイル選択ダイアログが開き、選択したシーンがエディタで開かれます。

- **エクスポート**  
  現在開いているシーンのタイルマップ情報を `Assets/MapEditor/Migration/` 配下にテキスト形式で出力します。  
  ファイル名はシーン名と同じ（例: `tilemap_1_1.unity` → `tilemap_1_1.txt`）です。  
  既存のエクスポートファイルがある場合は上書きされます。  
  → `エクスポート` ボタンを押すと、現在のタイル情報がテキストファイルとして出力されます。完了ダイアログが表示されます。

- **タイル情報の一括管理**  
  配置済みタイルの一覧表示、フィルタ・ソート、個別編集・削除が可能です。  
  → `タイルリスト` を展開すると、全タイルのリストが表示されます。  
  → 各タイルの「削除」ボタンで該当タイルとTilemap上のタイルが削除されます。  
  → タイルをクリックすると詳細編集パネルが表示されます。

- **タイル編集**  
  タイルごとにID、グループID、地形種別、ギミック種別、ギミックマスターID、移動可否、位置情報を編集できます。  
  → 詳細パネルで値を変更すると即時反映されます。

- **モード切替**  
  - `選択モード`：タイル情報の編集・選択が可能です。  
  - `配置モード`：Unity標準のTilemapツールでタイル配置が可能です。  
  → モードボタンで切り替えます。

- **カメラ倍率・マップサイズ調整**  
  - `Camera倍率変更(プレビュー用)`：シーン内カメラの拡大縮小が可能です。  
  - `マップサイズ`：背景スプライトのサイズを調整できます。

---

## ウィンドウの使い方

1. **ウィンドウの表示**  
   メニューから `Boys2 > Tile Map Editor` を選択してウィンドウを開きます。

2. **グループIDの入力**  
   `Group ID` 欄に任意のグループIDを入力します。

3. **モード切替**  
   - `選択モード` ボタン：タイルの選択・編集ができます。  
   - `配置モード` ボタン：Unity標準のTilemapツールでタイル配置ができます。

4. **新規作成**  
   `新規作成` ボタンでテンプレートシーンを複製し、新しいシーンを作成・オープンします。

5. **編集**  
   `編集` ボタンで既存のシーンファイルを選択して開きます。

6. **カメラ倍率・マップサイズ調整**  
   - `Camera倍率変更(プレビュー用)` でシーンカメラのズームを調整できます。  
   - `マップサイズ` で背景スプライトのサイズを変更できます。

7. **エクスポート**  
   `エクスポート` ボタンで、現在開いているシーンのタイルマップ情報をテキストファイルとして出力します。  
   完了時にダイアログが表示されます。

8. **タイル編集**  
   - `タイルリスト` を展開すると、配置済みタイルの一覧が表示されます。  
   - 各タイルをクリックすると詳細編集パネルが表示され、IDや種別、移動可否などを編集できます。  
   - 「削除」ボタンで該当タイルとTilemap上のタイルが削除されます。  
   - 「選択解除」ボタンで選択状態を解除できます。

9. **SceneViewでのタイル選択**  
   - SceneView上でタイルをクリックすると、そのタイルがエディタ上で選択され、詳細が表示されます。  
   - 選択中タイルはSceneView上でハイライト表示されます。

---

## マップの作り方

1. **道などのフィールドチップの配置**  
   Tile Paletteウィンドウから `Field` を選択し、任意のブラシでSceneView上に配置します。

2. **障害物やイベントなどのギミックマスの配置**  
   Tile Paletteウィンドウから `Gimmick` を選択し、任意のブラシでSceneView上に配置します。

3. **マップ設定**  
   - Camera倍率変更でカメラの拡大縮小が可能です。  
   - マップサイズは背景スプライトのサイズで調整します。  
   - 配置範囲の周囲を1マス幅で囲うため、想定マス数＋2で設定してください（例：50x50なら52x52）。

4. **タイル情報の編集**  
   - `選択モード` でタイルリストから編集したいタイルを選択し、詳細パネルで各種情報を編集します。

5. **エクスポート**  
   - 編集が完了したら `エクスポート` ボタンでデータを出力してください。

---

## 注意事項

- テンプレートシーン（`Assets/MapEditor/Scene/MapEditorTemplate.unity`）が必要です。
- シーン内に `Field` および `Gimmick` という名前のTilemapが必要です。
- タイルパレットウィンドウは `Window > 2D > Tile Palette` から手動で開いてください（自動ドッキング不可）。
- テンプレートシーン（`MapEditorTemplate.unity`）自体では編集できません。
- シーン名に `tilemap` を含む場合のみ利用可能です。
- タイル配置後は必ずエクスポートしてデータを保存してください。
- エディタウィンドウ上で警告が表示された場合は指示に従ってください。

---

## ファイル構成

- `Assets/MapEditor/Scripts/Editor/TileMapEditor.cs`  
  エディタ本体
- `Assets/MapEditor/Scripts/Editor/TileMapSceneController.cs`  
  シーン・Tilemap操作管理
- `Assets/MapEditor/Scripts/Editor/TileMapUiHelper.cs`  
  UIスタイル・共通UI部品
- `Assets/MapEditor/Scripts/TileDataManager.cs`  
  タイルデータ定義・管理
- `Assets/MapEditor/Scripts/Enum.cs`  
  列挙型・拡張メソッド
- `Assets/MapEditor/Migration/`  
  エクスポート先ディレクトリ
- `Assets/MapEditor/Resources/TileDataManager_*.asset`  
  タイルデータ管理用アセット

---

## サポート

不明点や不具合は山田までご連絡ください。
